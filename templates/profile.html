{% extends "base.html" %}

{% block content %}
<h2>Your Favorites</h2>

<!-- Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
    <div class="mt-3">
        {% for category, message in messages %}
        <div class="alert alert-{{ category }}">{{ message }}</div>
        {% endfor %}
    </div>
{% endif %}
{% endwith %}

<div class="accordion" id="favoritesAccordion">
    {% for list in lists_with_restaurants %}
    <div class="accordion-item">
        <h2 class="accordion-header" id="heading{{ list.list_id }}">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ list.list_id }}" aria-expanded="true" aria-controls="collapse{{ list.list_id }}">
                {{ list.name }}
            </button>
        </h2>
        <div id="collapse{{ list.list_id }}" class="accordion-collapse collapse {% if loop.first %}show{% endif %}" aria-labelledby="heading{{ list.list_id }}" data-bs-parent="#favoritesAccordion">
            <div class="accordion-body">
                {% if list.restaurants %}
                <table class="table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Address</th>
                            <th>Phone</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for restaurant in list.restaurants %}
                        <tr>
                            <td>{{ restaurant.name }}</td>
                            <td>{{ restaurant.address }}</td>
                            <td>{{ restaurant.contact_number }}</td>
                            <td>
                                <form action="/remove_from_list" method="POST" style="display:inline;">
                                    <input type="hidden" name="list_id" value="{{ list.list_id }}">
                                    <input type="hidden" name="restaurant_id" value="{{ restaurant.restaurant_id }}">
                                    <button type="submit" class="btn btn-danger">Remove</button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <p>No restaurants saved in this list.</p>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>
<div class="mt-4">
    <a href="/edit_account" class="btn btn-warning">Edit Account</a>
    <form action="/delete_account" method="POST" style="display:inline;">
        <button type="submit" class="btn btn-danger">Delete Account</button>
    </form>
</div>
{% endblock %}